import { ConfigApiService, CurrentSemesterStatus, SemesterInfo } from '../../services/api/ConfigApiService';
import { CourseApiService, CourseInfo, CoursePosition } from '../../services/api/CourseApiService';
import { AppConfigManager } from '../../services/AppConfigManager';
import { UserInfoManager } from '../../common/constants/PreferencesUtil';
import { curves } from '@kit.ArkUI';
import { hilog } from '@kit.PerformanceAnalysisKit';

// å‘¨æ—¥æœŸèŒƒå›´æ¥å£
interface WeekDateRange {
  startDate: Date;
  endDate: Date;
}

// è¯¾ç¨‹ç½‘æ ¼æ•°æ®æ¥å£ï¼ˆå‚ç…§class-schedule-cï¼‰
interface ScheduleCourse {
  courseName: string;
  classroom: string[];
  teacher: string[];
  campus: string;
  courseTime: number[][]; // [[1,2], [3,4]] æ ¼å¼
  weekday: number; // 1-7 å¯¹åº”å‘¨ä¸€åˆ°å‘¨æ—¥
  section: number[]; // èŠ‚æ¬¡æ•°ç»„
  courseId: string[];
}

// æ‰©å±•çš„è¯¾ç¨‹æ¥å£ï¼ŒåŒ…å«å‘¨æ¬¡ä¿¡æ¯
interface ScheduleCourseWithWeeks extends ScheduleCourse {
  weeks?: string;
}

// å‘¨è¯¾è¡¨ç½‘æ ¼å¸ƒå±€æ•°æ®
interface WeekScheduleGrid {
  nowClassList: ScheduleCourse[][]; // [å‘¨ä¸€[], å‘¨äºŒ[], ...å‘¨æ—¥[]]
  classNum: number[][]; // æ¯å¤©æ¯é—¨è¯¾å¼€å§‹çš„èŠ‚æ¬¡
  classLength: number[][]; // æ¯å¤©æ¯é—¨è¯¾çš„é•¿åº¦
  isContinue: number[][]; // è¯¾ç¨‹æ˜¯å¦è¿ç»­ï¼ˆ1=è¿ç»­ï¼Œ0=ä¸è¿ç»­ï¼‰
  classList: string[]; // å»é‡åçš„æ‰€æœ‰è¯¾ç¨‹å
}

// è¯¾ç¨‹æ—¶é—´æ®µé…ç½®æ¥å£
interface SectionsConfig {
  value1: number[];
  value2: number[];
  value3: number[];
  value4: number[];
  value5: number[];
  value6: number[];
}

// è¯¾ç¨‹é¢œè‰²é…ç½®
interface CourseColors {
  backgroundColor: string;
  textColor: string;
  borderColor: string;
}

@Component
export struct SchedulePage {
  private pathStack: NavPathStack = new NavPathStack();
  @State private currentWeek: number = 1;
  @State private totalWeeks: number = 20;
  @State private currentMonth: string = '';
  @State private weekDates: WeekDateRange | null = null;
  @State private showWeekPicker: boolean = false;
  // æ–°å¢å­¦æœŸç®¡ç†ç›¸å…³çŠ¶æ€
  @State private currentStatus: CurrentSemesterStatus | null = null;
  @State private currentSemester: SemesterInfo | null = null;
  @State private semesterList: SemesterInfo[] = [];
  @State private displayStatusText: string = "ç¬¬1å‘¨";
  // æ–°å¢åŸºäºæ—¥æœŸçš„æ»‘åŠ¨çŠ¶æ€
  @State private currentDate: Date = new Date(); // å½“å‰æ˜¾ç¤ºçš„æ—¥æœŸ
  // æ»‘åŠ¨æ‰‹åŠ¿çŠ¶æ€
  @State private startTime: number = 0;
  @State private startPosition: number = 0;
  @State private endPosition: number = 0;
  // æ–°å¢è¯¾ç¨‹æ•°æ®ç›¸å…³çŠ¶æ€
  @State private coursePositions: CoursePosition[] = [];
  @State private isLoadingCourses: boolean = false;
  private configService: ConfigApiService = ConfigApiService.getInstance();
  private courseService: CourseApiService = CourseApiService.getInstance();
  private appConfigManager: AppConfigManager = AppConfigManager.getInstance();
  private userInfoManager: UserInfoManager = UserInfoManager.getInstance();
  private weekDays: string[] = ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'];
  // å‚ç…§class-schedule-cçš„sectionsé…ç½®
  private sections: SectionsConfig = {
    value1: [1, 2],
    value2: [3, 4],
    value3: [5, 6],
    value4: [7, 8],
    value5: [9, 10],
    value6: [11, 12],
  };
  private betweenHeight: number = 5; // å¢åŠ ä¸€å¤§èŠ‚è¯¾é—´éš”é«˜åº¦
  private boxHeight: number = 25; // å¢åŠ ä¸€å°èŠ‚è¯¾é«˜åº¦
  // å‘¨è¯¾è¡¨ç½‘æ ¼æ•°æ®
  @State private scheduleGrid: WeekScheduleGrid = {
    nowClassList: [],
    classNum: [],
    classLength: [],
    isContinue: [],
    classList: []
  };
  // è¯¾ç¨‹é¢œè‰²æ˜ å°„
  private courseColorMap: Map<string, CourseColors> = new Map();
  // å®é™…è¯¾ç¨‹æ•°æ® - ç§»é™¤æ¨¡æ‹Ÿæ•°æ®ï¼Œä½¿ç”¨æ¥å£æ•°æ®
  @State private courseList: CourseInfo[] = [];
  // åŠ¨ç”»æ”¯æŒ
  private effect: TransitionEffect =
    TransitionEffect.OPACITY
      .combine(TransitionEffect.scale({ x: 0, y: 0 }))
      .animation({ curve: curves.springMotion(0.8, 1.0), duration: 150 }); // ä»250å‡å°‘åˆ°150
  // è¯¾ç¨‹å—å¯è§æ€§çŠ¶æ€
  @State private courseBlockVisible: boolean[][] = [];

  aboutToAppear(): void {
    // åŸºäºæ—¥æœŸçš„åˆå§‹åŒ–é€»è¾‘
    this.initializeWithCurrentDate();
  }

  build() {
    Stack() {
      Column() {
        // é¡¶éƒ¨æ—¥æœŸå’Œå‘¨æ¬¡tabbar
        Row() {
          // å‘¨æ•°å¯ç‚¹å‡»åŒºåŸŸ
          Row() {
            Text(this.displayStatusText || `ç¬¬${this.currentWeek || 1}å‘¨`)
              .fontSize(22)
              .fontWeight(FontWeight.Bold)
              .fontColor(this.currentStatus?.isInHoliday ? '#FF9800' : '#333333') // å‡æœŸä¸­ç”¨æ©™è‰²
            Text('â–¼')
              .fontSize(14)
              .fontColor('#999999')
              .margin({ left: 4 })
          }
          .padding({
            left: 8,
            right: 8,
            top: 4,
            bottom: 4
          })
          .borderRadius(4)
          .onClick(() => {
            this.showWeekPicker = true;
          })
        }
        .width('100%')
        .padding({
          left: 6,
          right: 6,
          top: 15,
          bottom: 5
        })
        .backgroundColor(Color.White)
        .bindSheet($$this.showWeekPicker, this.WeekPickerBuilder(), {
          showClose:false,
          height: 500,
          dragBar: true,
          maskColor: 'rgba(0, 0, 0, 0.4)',
          onAppear: () => {
            console.log("å‘¨é€‰æ‹©å™¨æ˜¾ç¤º");
          },
          onDisappear: () => {
            console.log("å‘¨é€‰æ‹©å™¨éšè—");
          }
        })

        // è¯¾è¡¨å†…å®¹åŒºåŸŸ - æ”¯æŒè§¦æ‘¸æ»‘åŠ¨æ‰‹åŠ¿
        Column() {
          this.WeekScheduleContent()
        }
        .width('100%')
        .layoutWeight(1)
        .onTouch((event: TouchEvent) => {
          if (event.type === TouchType.Down) {
            this.touchStart(event);
          } else if (event.type === TouchType.Up) {
            this.touchEnd(event);
          }
          return true;
        })
      }
      .width('100%')
      .height('100%')
      .backgroundColor(Color.White)
    }
    .width('100%')
    .height('100%')
  }

  @Builder
  WeekScheduleContent() {
    Column() {
      // æ˜ŸæœŸè¡¨å¤´ï¼ˆå‚è€ƒshow-list.vueçš„table-headerç»“æ„ï¼‰
      Row() {
        // å·¦ä¸Šè§’æœˆä»½æ˜¾ç¤ºåŒºåŸŸ
        Column() {
          Text(this.currentMonth.substring(0,this.currentMonth.length-1))
            .fontSize(14)
            .fontColor('#333333')
            .fontWeight(FontWeight.Medium)
            .margin({ bottom: 2 })
          Text('æœˆ')
            .fontSize(14)
            .fontColor('#333333')
            .fontWeight(FontWeight.Medium)
            .margin({ bottom: 2 })
        }
        .width(40)
        .height(60)
        .justifyContent(FlexAlign.Center)
        .backgroundColor(Color.White)
        .alignItems(HorizontalAlign.Center)

        // æ˜ŸæœŸæ ‡é¢˜å’Œæ—¥æœŸï¼ˆå‚è€ƒshow-list.vueçš„second-week-boxï¼‰
        ForEach(this.weekDays, (day: string, dayIndex: number) => {
          Column() {
            // æ˜ŸæœŸ
            Text(day)
              .fontSize(14)
              .fontColor('#333333')
              .fontWeight(FontWeight.Medium)
              .margin({ bottom: 2 })

            // æ˜¾ç¤ºå¯¹åº”çš„æ—¥æœŸï¼ˆå‚è€ƒclass-schedule-cçš„timeListé€»è¾‘ï¼‰
            if (this.weekDates) {
              Text(this.getDateForWeekDay(dayIndex))
                .fontSize(14)
                .fontColor(this.isToday(dayIndex) ? '#45CAD9' : '#666666')
                .backgroundColor(this.isToday(dayIndex) ? '#E3F2FD' : Color.Transparent)
                .borderRadius(8)
                .padding({
                  left: 4,
                  right: 4,
                  top: 2,
                  bottom: 2
                })
            }
          }
          .layoutWeight(1)
          .height(55)
          .justifyContent(FlexAlign.Center)
          .alignItems(HorizontalAlign.Center)
          .backgroundColor(Color.White)
        })
      }
      .width('100%')

      // è¯¾è¡¨å†…å®¹åŒºåŸŸï¼ˆå‚è€ƒshow-list.vueçš„class-tableç»“æ„ï¼‰
      Scroll() {
        Row() {
          // å·¦ä¾§æ—¶é—´è½´ï¼ˆå‚è€ƒshow-list.vueçš„class-timeï¼‰
          this.buildTimeColumn()

          // è¯¾ç¨‹ç½‘æ ¼åŒºåŸŸï¼ˆå‚è€ƒshow-list.vueçš„class-tableï¼‰
          Row() {
            ForEach([0, 1, 2, 3, 4, 5, 6], (dayIndex: number) => {
              this.buildDayColumn(dayIndex)
            })
          }
          .layoutWeight(1)
          .backgroundColor(Color.White)
          .alignItems(VerticalAlign.Top)
        }
        .height('100%')
        .width('100%')
        .alignItems(VerticalAlign.Top)
      }
      .layoutWeight(1)
      .align(Alignment.TopStart)
    }
    .width('100%')
    .height('100%')
  }

  /**
   * æ„å»ºæ—¶é—´åˆ—ï¼ˆå‚è€ƒshow-list.vueçš„class-timeç»“æ„ï¼‰
   */
  @Builder
  buildTimeColumn() {
    Column() {
      // ç›´æ¥æ˜¾ç¤º1-12èŠ‚ï¼Œå‡åŒ€åˆ†å¸ƒ
      ForEach([1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12], (num: number) => {
        Text(num.toString())
          .fontSize(12)
          .fontColor('#666666')
          .width('100%')
          .textAlign(TextAlign.Center)
          .layoutWeight(1) // ä½¿ç”¨layoutWeightå®ç°å‡åŒ€åˆ†å¸ƒ
      })
    }
    .height('100%')
    .width(40)
    .backgroundColor(Color.White)
  }

  /**
   * æ„å»ºå•å¤©è¯¾ç¨‹åˆ—ï¼ˆå‚è€ƒshow-list.vueçš„ç½‘æ ¼å¸ƒå±€ç®—æ³•ï¼‰
   */
  @Builder
  buildDayColumn(dayIndex: number) {
    Column() {
      // ç›´æ¥æ˜¾ç¤ºæ‰€æœ‰è¯¾ç¨‹ï¼Œä¸è¿›è¡Œå¤æ‚çš„è¿ç»­æ€§åˆ¤æ–­
      ForEach(this.scheduleGrid.nowClassList[dayIndex] || [], (course: ScheduleCourse, courseIndex: number) => {
        this.buildCourseBlock(course,
          this.scheduleGrid.classLength[dayIndex] ? this.scheduleGrid.classLength[dayIndex][courseIndex] : 1, dayIndex,
          courseIndex)
      })
    }
    .backgroundColor(Color.White)
    .width(`${100 / 7}%`) // 7åˆ—ç­‰å®½
    .alignItems(HorizontalAlign.Center)
    .padding(1) // å‡å°‘å†…è¾¹è·
  }

  /**
   * æ„å»ºè¯¾ç¨‹å—ï¼ˆå‚è€ƒshow-list.vueçš„class-table-itemæ ·å¼ï¼‰
   */
  @Builder
  buildCourseBlock(course: ScheduleCourse, length: number, dayIndex: number, courseIndex: number) {
    // æ‰€æœ‰è¯¾ç¨‹ä¸€æ¬¡æ€§æ˜¾ç¤ºï¼Œåªåœ¨åŠ¨ç”»çŠ¶æ€æ§åˆ¶æ˜¾ç¤º/éšè—
    if (this.courseBlockVisible.length === 0 || 
        !this.courseBlockVisible[dayIndex] || 
        this.courseBlockVisible[dayIndex].length === 0 ||
        this.courseBlockVisible[dayIndex][courseIndex] !== false) {
      Column() {
        // è¯¾ç¨‹åç§°
        Text(course.courseName)
          .fontSize(11)
          .fontColor(this.getCourseTextColor(course.courseName))
          .fontWeight(FontWeight.Medium)
          .maxLines(2)
          .textOverflow({ overflow: TextOverflow.Ellipsis })
          .textAlign(TextAlign.Center)
          .margin({ bottom: 2 })

        // æ•™å®¤ä¿¡æ¯
        if (course.classroom && course.classroom.length > 0) {
          Text(course.classroom[0])
            .fontSize(9)
            .fontColor(this.getCourseTextColor(course.courseName))
            .maxLines(1)
            .textOverflow({ overflow: TextOverflow.Ellipsis })
            .textAlign(TextAlign.Center)
            .margin({ bottom: 1 })
        }

        // æ•™å¸ˆä¿¡æ¯
        if (course.teacher && course.teacher.length > 0) {
          Text(course.teacher[0])
            .fontSize(8)
            .fontColor(this.getCourseTextColor(course.courseName))
            .maxLines(1)
            .textOverflow({ overflow: TextOverflow.Ellipsis })
            .textAlign(TextAlign.Center)
        }
      }
      .transition(this.effect) // åº”ç”¨è½¬åœºåŠ¨ç”»
      .width('95%')
      .height(`${length * 8.33}%`)
      .backgroundColor(this.getCourseBackgroundColor(course.courseName))
      .border({
        width: 1,
        color: this.getCourseBorderColor(course.courseName),
        radius: 4
      })
      .padding(3)
      .justifyContent(FlexAlign.Center)
      .alignItems(HorizontalAlign.Center)
      .margin({ top: 1, bottom: 1 })
      .onClick(() => {
        this.onCourseBlockClick(course, dayIndex, courseIndex);
      })
    }
  }

  /**
   * å¤„ç†å‘¨è¯¾è¡¨æ•°æ®ï¼ˆä½¿ç”¨æ¥å£æ•°æ®ï¼‰
   */
  private processWeekScheduleData(): void {
    console.info('ğŸ“… [Schedule] å¼€å§‹å¤„ç†å‘¨è¯¾è¡¨æ•°æ®...');

    // åˆå§‹åŒ–ç½‘æ ¼æ•°æ®ç»“æ„
    this.initializeScheduleGrid();

    // å¤„ç†è¯¾ç¨‹æ•°æ®
    this.processCourseList();

    // è®¡ç®—è¯¾ç¨‹å¸ƒå±€
    this.calculateCourseLayout();

    console.info('ğŸ“… [Schedule] å‘¨è¯¾è¡¨æ•°æ®å¤„ç†å®Œæˆ');
  }

  /**
   * åˆå§‹åŒ–è¯¾è¡¨ç½‘æ ¼ç»“æ„
   */
  private initializeScheduleGrid(): void {
    // 7å¤©çš„è¯¾ç¨‹åˆ—è¡¨
    this.scheduleGrid.nowClassList = Array(7).fill(null).map(() => []);
    this.scheduleGrid.classNum = Array(7).fill(null).map(() => []);
    this.scheduleGrid.classLength = Array(7).fill(null).map(() => []);
    this.scheduleGrid.isContinue = Array(7).fill(null).map(() => []);
    this.scheduleGrid.classList = [];
    // åˆå§‹åŒ–è¯¾ç¨‹å—å¯è§æ€§çŠ¶æ€
    this.courseBlockVisible = Array(7).fill(null).map(() => []);
  }

  /**
   * å¤„ç†è¯¾ç¨‹åˆ—è¡¨ï¼ˆä½¿ç”¨æ¥å£æ•°æ®è½¬æ¢ä¸ºè¯¾è¡¨æ ¼å¼ï¼‰
   */
  private processCourseList(): void {
    // å°†æ¥å£è¿”å›çš„CourseInfo[]è½¬æ¢ä¸ºScheduleCourse[]æ ¼å¼
    const convertedCourses = this.convertCourseInfoToScheduleCourse(this.courseList);

    // è¿‡æ»¤å½“å‰å‘¨çš„è¯¾ç¨‹
    const weekCourses = convertedCourses.filter(course => {
      // è§£æè¯¾ç¨‹çš„å‘¨æ¬¡ä¿¡æ¯ï¼Œåˆ¤æ–­æ˜¯å¦åŒ…å«å½“å‰å‘¨
      return this.isCourseInCurrentWeek(course, this.currentWeek);
    });

    // æŒ‰å‘¨å‡ åˆ†ç»„
    for (let dayIndex = 0; dayIndex < 7; dayIndex++) {
      const dayCourses = weekCourses.filter(course => course.weekday === dayIndex + 1);
      this.scheduleGrid.nowClassList[dayIndex] = dayCourses;
    }

    // æå–æ‰€æœ‰è¯¾ç¨‹åï¼ˆå»é‡ï¼‰
    const courseNameSet = new Set<string>();
    weekCourses.forEach(course => {
      courseNameSet.add(course.courseName);
    });
    this.scheduleGrid.classList = Array.from(courseNameSet);
    
    // è§¦å‘å…¥åœºåŠ¨ç”»
    this.triggerCourseBlockEnterAnimation();

    console.info(`ğŸ“š [Course] å¤„ç†äº†${this.courseList.length}é—¨è¯¾ç¨‹ï¼Œå½“å‰å‘¨æœ‰${weekCourses.length}é—¨è¯¾ç¨‹`);
  }

  /**
   * å°†CourseInfoè½¬æ¢ä¸ºScheduleCourseæ ¼å¼
   */
  private convertCourseInfoToScheduleCourse(courseList: CourseInfo[]): ScheduleCourseWithWeeks[] {
    return courseList.map(course => {
      const scheduleCourse: ScheduleCourseWithWeeks = {
        courseName: course.courseName,
        classroom: [course.classroom], // å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°ç»„
        teacher: [course.teacher], // å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°ç»„
        campus: course.campus || '', // ä½¿ç”¨æ¥å£æ•°æ®ä¸­çš„campuså­—æ®µ
        courseTime: this.parseCourseTime(course.section),
        weekday: this.parseWeekday(course.weekday),
        section: this.parseSection(course.section),
        courseId: [course.courseId.toString()], // è½¬æ¢ä¸ºå­—ç¬¦ä¸²æ•°ç»„
        weeks: course.weeks // ä¿å­˜åŸå§‹å‘¨æ¬¡ä¿¡æ¯ç”¨äºè¿‡æ»¤
      };
      return scheduleCourse;
    });
  }

  /**
   * åˆ¤æ–­è¯¾ç¨‹æ˜¯å¦åœ¨å½“å‰å‘¨
   */
  private isCourseInCurrentWeek(course: ScheduleCourseWithWeeks, currentWeek: number): boolean {
    if (!course.weeks) {
      return true;
    } // å¦‚æœæ²¡æœ‰å‘¨æ¬¡ä¿¡æ¯ï¼Œé»˜è®¤æ˜¾ç¤º

    const weekRanges = this.parseWeekRange(course.weeks);
    return weekRanges.includes(currentWeek);
  }

  /**
   * è§£æå‘¨æ¬¡èŒƒå›´ï¼Œé€‚é…æ¥å£æ ¼å¼ "[2,3,4,6,7,8,9,10,11]"
   */
  private parseWeekRange(weeksStr: string): number[] {
    const weeks: number[] = [];

    if (!weeksStr) {
      return weeks;
    }

    try {
      // æ¥å£è¿”å›çš„æ ¼å¼æ˜¯ "[2,3,4,6,7,8,9,10,11]"ï¼Œéœ€è¦è§£æä¸ºæ•°ç»„
      if (weeksStr.startsWith('[') && weeksStr.endsWith(']')) {
        const weekArray = JSON.parse(weeksStr) as number[];
        return weekArray.sort((a, b) => a - b);
      } else {
        // å¤„ç†ä¼ ç»Ÿæ ¼å¼: "1-16", "1,3,5-7"ç­‰
        const cleanWeeksStr = weeksStr.replace(/[å•åŒå‘¨]/g, '');
        const parts = cleanWeeksStr.split(',');

        parts.forEach(part => {
          if (part.includes('-')) {
            const dashIndex = part.indexOf('-');
            const start = parseInt(part.substring(0, dashIndex).trim());
            const end = parseInt(part.substring(dashIndex + 1).trim());
            for (let i = start; i <= end; i++) {
              if (!weeks.includes(i)) {
                weeks.push(i);
              }
            }
          } else {
            const week = parseInt(part.trim());
            if (!isNaN(week) && !weeks.includes(week)) {
              weeks.push(week);
            }
          }
        });
      }
    } catch (error) {
      console.error('è§£æå‘¨æ¬¡èŒƒå›´å¤±è´¥:', error, weeksStr);
    }

    return weeks.sort((a, b) => a - b);
  }

  /**
   * è§£æè¯¾ç¨‹æ—¶é—´ä¸ºäºŒç»´æ•°ç»„æ ¼å¼
   */
  private parseCourseTime(sectionStr: string): number[][] {
    const sections = this.parseSection(sectionStr);
    const result: number[][] = [];

    // å°†è¿ç»­çš„èŠ‚æ¬¡åˆ†ç»„
    let currentGroup: number[] = [];
    for (let i = 0; i < sections.length; i++) {
      if (i === 0 || sections[i] === sections[i - 1] + 1) {
        currentGroup.push(sections[i]);
      } else {
        if (currentGroup.length > 0) {
          result.push([...currentGroup]);
        }
        currentGroup = [sections[i]];
      }
    }

    if (currentGroup.length > 0) {
      result.push(currentGroup);
    }

    return result;
  }

  /**
   * è®¡ç®—è¯¾ç¨‹å¸ƒå±€ï¼ˆæ ¸å¿ƒç®—æ³•ï¼Œå‚è€ƒshow-list.vueçš„å¸ƒå±€é€»è¾‘ï¼‰
   */
  private calculateCourseLayout(): void {
    for (let dayIndex = 0; dayIndex < 7; dayIndex++) {
      const dayCourses = this.scheduleGrid.nowClassList[dayIndex];

      // åˆå§‹åŒ–å½“å¤©çš„å¸ƒå±€æ•°æ®
      this.scheduleGrid.classNum[dayIndex] = [];
      this.scheduleGrid.classLength[dayIndex] = [];
      this.scheduleGrid.isContinue[dayIndex] = [];

      // æŒ‰èŠ‚æ¬¡æ’åº
      const sortedCourses = dayCourses.sort((a, b) => a.section[0] - b.section[0]);

      for (let courseIndex = 0; courseIndex < sortedCourses.length; courseIndex++) {
        const course = sortedCourses[courseIndex];

        // è®¡ç®—è¯¾ç¨‹å¼€å§‹èŠ‚æ¬¡
        this.scheduleGrid.classNum[dayIndex][courseIndex] = course.section[0];

        // è®¡ç®—è¯¾ç¨‹é•¿åº¦ï¼ˆèŠ‚æ¬¡æ•°ï¼‰
        this.scheduleGrid.classLength[dayIndex][courseIndex] = course.section.length;

        // ç®€åŒ–è¿ç»­æ€§åˆ¤æ–­ï¼šé»˜è®¤æ‰€æœ‰è¯¾ç¨‹éƒ½åº”è¯¥æ˜¾ç¤º
        this.scheduleGrid.isContinue[dayIndex][courseIndex] = 1;
      }
    }
  }

  /**
   * è§£æå‘¨å‡ å­—ç¬¦ä¸²
   */
  private parseWeekday(weekdayStr: string): number {
    const weekdayMap: Record<string, number> = {
      'æ˜ŸæœŸä¸€': 1,
      'æ˜ŸæœŸäºŒ': 2,
      'æ˜ŸæœŸä¸‰': 3,
      'æ˜ŸæœŸå››': 4,
      'æ˜ŸæœŸäº”': 5,
      'æ˜ŸæœŸå…­': 6,
      'æ˜ŸæœŸæ—¥': 7
    };
    return weekdayMap[weekdayStr] || 1;
  }

  /**
   * è§£æèŠ‚æ¬¡å­—ç¬¦ä¸²ï¼Œé€‚é…æ¥å£æ ¼å¼ "1-2èŠ‚"
   */
  private parseSection(sectionStr: string): number[] {
    if (!sectionStr) {
      return [1];
    } // é»˜è®¤å€¼

    // ç§»é™¤"èŠ‚"å­—ç¬¦ï¼Œå¤„ç† "1-2èŠ‚" æ ¼å¼
    const cleanSectionStr = sectionStr.replace(/èŠ‚$/g, '');

    if (cleanSectionStr.includes('-')) {
      // "1-2" -> [1, 2]
      // "1-6" -> [1, 2, 3, 4, 5, 6]
      const parts = cleanSectionStr.split('-');
      if (parts.length === 2) {
        const start = parseInt(parts[0].trim());
        const end = parseInt(parts[1].trim());
        const sections: number[] = [];
        for (let i = start; i <= end; i++) {
          sections.push(i);
        }
        return sections;
      }
    } else if (cleanSectionStr.includes(',')) {
      // "1,2" -> [1, 2]
      return cleanSectionStr.split(',').map(s => parseInt(s.trim())).filter(n => !isNaN(n));
    } else {
      // "1" -> [1]
      const section = parseInt(cleanSectionStr.trim());
      return !isNaN(section) ? [section] : [1];
    }

    return [1]; // é»˜è®¤å€¼
  }

  /**
   * åŸºäºå½“å‰æ—¥æœŸåˆå§‹åŒ– - æ‰¾åˆ°æœ€è¿‘çš„å­¦æœŸå¹¶è®¡ç®—å½“å‰å‘¨æ•°
   */
  private async initializeWithCurrentDate(): Promise<void> {
    try {
      // ç¡®ä¿é…ç½®å·²åŠ è½½
      await this.appConfigManager.initialize();
      this.semesterList = this.configService.getSemesterList();

      if (this.semesterList.length === 0) {
        console.error('ğŸ“‹ [Schedule] æ²¡æœ‰å­¦æœŸæ•°æ®');
        return;
      }

      // ä½¿ç”¨ä»Šå¤©çš„æ—¥æœŸä½œä¸ºèµ·å§‹ç‚¹
      const today = new Date();
      this.currentDate = new Date(today);

      // æ‰¾åˆ°æœ€è¿‘çš„å­¦æœŸå’Œè®¡ç®—å‘¨æ•°
      this.updateCurrentSemesterFromDate(this.currentDate);

      // è®¡ç®—å½“å‰æ—¥æœŸå¯¹åº”çš„å‘¨æ—¥æœŸèŒƒå›´
      this.calculateWeekDatesFromCurrentDate();

      // åŠ è½½è¯¾ç¨‹æ•°æ®
      await this.loadCourseData();

      console.info(`ğŸ“… [Schedule Init] åˆå§‹åŒ–å®Œæˆ: ${this.currentDate.getFullYear()}-${this.currentDate.getMonth() +
        1}-${this.currentDate.getDate()}`);

    } catch (error) {
      console.error('ğŸ“‹ [Schedule] æ—¥æœŸåˆå§‹åŒ–å¤±è´¥:', error);
    }
  }

  /**
   * åŠ è½½è¯¾ç¨‹æ•°æ®
   */
  private async loadCourseData(): Promise<void> {
    if (!this.currentSemester) {
      console.warn('ğŸ“š [Course] å½“å‰å­¦æœŸä¿¡æ¯ä¸ºç©ºï¼Œæ— æ³•åŠ è½½è¯¾ç¨‹');
      return;
    }

    this.isLoadingCourses = true;

    try {
      // ä»é¦–é€‰é¡¹è·å–ç”¨æˆ·ç­çº§ä¿¡æ¯
      const userInfo = this.userInfoManager.getUserInfo();
      console.info(`ğŸ“š [Course] å½“å‰ç”¨æˆ·ä¿¡æ¯: å­¦é™¢=${userInfo.collegeName}, ä¸“ä¸š=${userInfo.majorName}, ç­çº§=${userInfo.className}`);

      const classId = userInfo.classId;

      if (!classId) {
        console.warn('ğŸ“š [Course] ç”¨æˆ·æœªè®¾ç½®ç­çº§ä¿¡æ¯ï¼Œæ— æ³•è·å–è¯¾ç¨‹æ•°æ®');
        console.warn('ğŸ“š [Course] è¯·åœ¨è®¾ç½®é¡µé¢é€‰æ‹©å­¦é™¢ã€ä¸“ä¸šå’Œç­çº§');
        return;
      }

      // æ„å»ºè¯·æ±‚å‚æ•° - ä½¿ç”¨å­¦æœŸä¿¡æ¯å’Œç”¨æˆ·ç­çº§ID
      const params = this.courseService.buildCourseParams(
        this.currentSemester.academicYear,
        this.currentSemester.semester,
        this.currentWeek, // æ·»åŠ å½“å‰å‘¨æ•°
        classId,
        undefined
      );

      console.info(`ğŸ“š [Course] è¯·æ±‚è¯¾ç¨‹æ•°æ®: ${JSON.stringify(params)}`);

      // è·å–è¯¾ç¨‹åˆ—è¡¨
      const courseResponse = await this.courseService.getCourseList(params);

      if (courseResponse.code === 200 && courseResponse.data) {
        // å°†æ¥å£æ•°æ®èµ‹å€¼ç»™ courseList çŠ¶æ€å˜é‡
        this.courseList = courseResponse.data;

        // å¤„ç†è¯¾ç¨‹æ•°æ®ï¼Œç”Ÿæˆè¯¾è¡¨ç½‘æ ¼
        this.processWeekScheduleData();

        console.info(`ğŸ“š [Course] æˆåŠŸåŠ è½½${courseResponse.data.length}é—¨è¯¾ç¨‹`);
      } else {
        console.warn(`ğŸ“š [Course] è¯¾ç¨‹æ•°æ®åŠ è½½å¤±è´¥: ${courseResponse.msg}`);
        this.courseList = [];
        // å³ä½¿æ²¡æœ‰æ•°æ®ä¹Ÿè¦åˆå§‹åŒ–ç©ºçš„ç½‘æ ¼
        this.processWeekScheduleData();
      }

    } catch (error) {
      console.error('ğŸ“š [Course] åŠ è½½è¯¾ç¨‹æ•°æ®å¤±è´¥:', error);
      this.courseList = [];
      // å³ä½¿å‡ºé”™ä¹Ÿè¦åˆå§‹åŒ–ç©ºçš„ç½‘æ ¼
      this.processWeekScheduleData();
    } finally {
      this.isLoadingCourses = false;
    }
  }

  /**
   * æ ¹æ®ç»™å®šæ—¥æœŸæ‰¾åˆ°æœ€è¿‘çš„å­¦æœŸå¹¶è®¡ç®—å‘¨æ•°
   * ç›´æ¥ä½¿ç”¨ConfigApiServiceçš„calculateCurrentSemesterStatusé€»è¾‘
   */
  private updateCurrentSemesterFromDate(targetDate: Date): void {
    // ä½¿ç”¨ConfigApiServiceçš„å·²æœ‰é€»è¾‘æ¥è®¡ç®—çŠ¶æ€
    const semesterStatus = this.configService.calculateCurrentSemesterStatus(targetDate);

    if (semesterStatus && semesterStatus.currentSemester) {
      this.currentSemester = semesterStatus.currentSemester;
      this.currentWeek = semesterStatus.currentWeek;
      this.totalWeeks = semesterStatus.currentSemester.totalWeeks;
      this.displayStatusText = semesterStatus.statusText;

      console.info(`ğŸ“… [Semester Update] ${semesterStatus.currentSemester.academicYear}å­¦å¹´ç¬¬${semesterStatus.currentSemester.semester}å­¦æœŸ - ${semesterStatus.statusText} (å‘¨æ•°: ${semesterStatus.currentWeek})`);
    }
  }

  /**
   * æ ¹æ®å½“å‰æ—¥æœŸè®¡ç®—å‘¨æ—¥æœŸèŒƒå›´
   */
  private calculateWeekDatesFromCurrentDate(): void {
    // æ‰¾åˆ°å½“å‰æ—¥æœŸæ‰€åœ¨å‘¨çš„å‘¨ä¸€
    const currentDate = new Date(this.currentDate);
    const dayOfWeek = currentDate.getDay();
    const daysToMonday = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;

    const mondayOfWeek = new Date(currentDate);
    mondayOfWeek.setDate(currentDate.getDate() + daysToMonday);

    // è®¡ç®—å‘¨æ—¥
    const sundayOfWeek = new Date(mondayOfWeek);
    sundayOfWeek.setDate(mondayOfWeek.getDate() + 6);

    this.weekDates = {
      startDate: mondayOfWeek,
      endDate: sundayOfWeek
    };

    this.currentMonth = this.configService.getMonthString(mondayOfWeek);
  }

  /**
   * å¯¼èˆªåˆ°ä¸Šä¸€å‘¨
   */
  private async navigateToPreviousWeek(): Promise<void> {
    // å…ˆæ’­æ”¾é€€åœºåŠ¨ç”»
    await this.triggerCourseBlockExitAnimation();
    
    // å½“å‰æ—¥æœŸå‡å»7å¤©
    const newDate = new Date(this.currentDate);
    newDate.setDate(this.currentDate.getDate() - 7);

    this.currentDate = newDate;
    this.updateCurrentSemesterFromDate(this.currentDate);
    this.calculateWeekDatesFromCurrentDate();

    // é‡æ–°åŠ è½½è¯¾ç¨‹æ•°æ®ï¼ˆå¦‚æœå­¦æœŸå‘ç”Ÿå˜åŒ–ï¼‰
    await this.loadCourseData();

    console.info(`ğŸ“… [Navigate] å·¦æ»‘åˆ°ä¸Šä¸€å‘¨: ${newDate.getFullYear()}-${newDate.getMonth() + 1}-${newDate.getDate()}`);
  }

  /**
   * å¯¼èˆªåˆ°ä¸‹ä¸€å‘¨
   */
  private async navigateToNextWeek(): Promise<void> {
    // å…ˆæ’­æ”¾é€€åœºåŠ¨ç”»
    await this.triggerCourseBlockExitAnimation();
    
    // å½“å‰æ—¥æœŸåŠ ä¸Š7å¤©
    const newDate = new Date(this.currentDate);
    newDate.setDate(this.currentDate.getDate() + 7);

    this.currentDate = newDate;
    this.updateCurrentSemesterFromDate(this.currentDate);
    this.calculateWeekDatesFromCurrentDate();

    // é‡æ–°åŠ è½½è¯¾ç¨‹æ•°æ®ï¼ˆå¦‚æœå­¦æœŸå‘ç”Ÿå˜åŒ–ï¼‰
    await this.loadCourseData();

    console.info(`ğŸ“… [Navigate] å³æ»‘åˆ°ä¸‹ä¸€å‘¨: ${newDate.getFullYear()}-${newDate.getMonth() + 1}-${newDate.getDate()}`);
  }

  /**
   * åˆ‡æ¢å­¦æœŸ (è·³è½¬åˆ°æŒ‡å®šå­¦æœŸçš„ç¬¬ä¸€å‘¨)
   */
  private async switchSemester(direction: 'prev' | 'next'): Promise<void> {
    if (!this.currentSemester) {
      return;
    }

    // æ‰¾åˆ°ç›®æ ‡å­¦æœŸ
    const rawTargetSemester = this.configService.getAdjacentSemester(this.currentSemester, direction);
    if (rawTargetSemester) {
      // è·³è½¬åˆ°ç›®æ ‡å­¦æœŸçš„å¼€å­¦æ—¥æœŸ
      const targetStartDate = new Date(rawTargetSemester.startDate);
      this.currentDate = targetStartDate;

      // æ›´æ–°å­¦æœŸä¿¡æ¯
      this.updateCurrentSemesterFromDate(this.currentDate);
      this.calculateWeekDatesFromCurrentDate();

      // é‡æ–°åŠ è½½æ–°å­¦æœŸçš„è¯¾ç¨‹æ•°æ®
      await this.loadCourseData();

      console.info(`ğŸ“… [Semester Switch] åˆ‡æ¢åˆ°${rawTargetSemester.academicYear}å­¦å¹´ç¬¬${rawTargetSemester.semester}å­¦æœŸ`);
    }
  }

  /**
   * è·å–æ˜ŸæœŸå¯¹åº”çš„æ—¥æœŸ
   */
  private getDateForWeekDay(dayIndex: number): string {
    if (!this.weekDates) {
      return '';
    }

    const targetDate = new Date(this.weekDates.startDate);
    targetDate.setDate(this.weekDates.startDate.getDate() + dayIndex);

    const month = targetDate.getMonth() + 1;
    const day = targetDate.getDate();
    return `${month}/${day}`;
  }

  /**
   * è§¦æ‘¸å¼€å§‹ (å‚è€ƒclass-schedule-cçš„touchStartæ–¹æ³•)
   */
  private touchStart(event: TouchEvent): void {
    this.startTime = Date.now();
    this.startPosition = event.touches[0].x;
  }

  /**
   * è§¦æ‘¸ç»“æŸ (å‚è€ƒclass-schedule-cçš„touchEndæ–¹æ³•)
   */
  private touchEnd(event: TouchEvent): void {
    const endTime = Date.now();
    // å¦‚æœè§¦æ‘¸æ—¶é—´è¶…è¿‡2ç§’ï¼Œå¿½ç•¥
    if (endTime - this.startTime > 2000) {
      return;
    }

    this.endPosition = event.changedTouches[0].x;

    // å½“ç§»åŠ¨è·ç¦»è¶…è¿‡100æ—¶åˆ¤æ–­å·¦æ»‘å³æ»‘ (ä¸class-schedule-cä¸€è‡´)
    if (Math.abs(this.endPosition - this.startPosition) > 100) {
      const elePosition = this.endPosition - this.startPosition > 0 ? "right" : "left";

      if (elePosition === 'right') {
        // å³æ»‘ï¼šæ˜¾ç¤ºä¸Šä¸€å‘¨ (å¯¹åº”class-schedule-cçš„leftClick)
        console.info(`ğŸ“… [Navigate] å³æ»‘åˆ°ä¸Šä¸€å‘¨`)
        this.navigateToPreviousWeek();

      } else if (elePosition === 'left') {
        console.info(`ğŸ“… [Navigate] å·¦æ»‘åˆ°ä¸‹ä¸€å‘¨`)
        // å·¦æ»‘ï¼šæ˜¾ç¤ºä¸‹ä¸€å‘¨ (å¯¹åº”class-schedule-cçš„rightClick)
        this.navigateToNextWeek();
      }
    }
  }

  /**
   * ç”Ÿæˆå‘¨æ•°åˆ—è¡¨
   */
  private getWeekNumbersList(): number[] {
    const weekNumbers: number[] = [];
    for (let i = 1; i <= this.totalWeeks; i++) {
      weekNumbers.push(i);
    }
    return weekNumbers;
  }

  @Builder
  WeekPickerBuilder() {
    Column() {
      // å­¦æœŸä¿¡æ¯å’Œåˆ‡æ¢æŒ‰é’®
      Row() {
        // ä¸Šä¸€ä¸ªå­¦æœŸæŒ‰é’®
        Button('< ä¸Šå­¦æœŸ')
          .fontSize(14)
          .fontColor('#45CAD9')
          .backgroundColor(Color.Transparent)
          .height(30)
          .onClick(async () => {
            await this.triggerCourseBlockExitAnimation();
            this.switchSemester('prev');
          })

        Blank()

        // å½“å‰å­¦æœŸä¿¡æ¯
        Text(`${this.currentSemester?.academicYear || '2024'}å­¦å¹´ç¬¬${this.currentSemester?.semester || 1}å­¦æœŸ`)
          .fontSize(16)
          .fontWeight(FontWeight.Medium)
          .fontColor('#333333')

        Blank()

        // ä¸‹ä¸€ä¸ªå­¦æœŸæŒ‰é’®
        Button('ä¸‹å­¦æœŸ >')
          .fontSize(14)
          .fontColor('#45CAD9')
          .backgroundColor(Color.Transparent)
          .height(30)
          .onClick(async () => {
            await this.triggerCourseBlockExitAnimation();
            this.switchSemester('next');
          })
      }
      .width('100%')
      .padding({  bottom: 10 })

      Divider()
        .color('#F0F0F0')
        .strokeWidth(0.5)
        .margin({ bottom: 10 })

      Text('é€‰æ‹©å‘¨æ¬¡')
        .fontSize(18)
        .fontWeight(FontWeight.Bold)
        .fontColor('#333333')
        .margin({ bottom: 20 })

      Scroll() {
        Column() {
          ForEach(this.getWeekNumbersList(), (weekNum: number) => {
            Row() {
              Text(`ç¬¬${weekNum}å‘¨`)
                .fontSize(16)
                .fontColor(this.currentWeek === weekNum ? '#45CAD9' : '#333333')
                .fontWeight(this.currentWeek === weekNum ? FontWeight.Medium : FontWeight.Normal)

              Blank()

              if (this.currentWeek === weekNum) {
                Text('âœ“')
                  .fontSize(16)
                  .fontColor('#45CAD9')
              }
            }
            .width('100%')
            .height(50)
            .padding({ left: 20, right: 20 })
            .onClick(async () => {
              // è·³è½¬åˆ°æŒ‡å®šå‘¨ï¼šè®¡ç®—ç›®æ ‡æ—¥æœŸå¹¶æ›´æ–°
              if (this.currentSemester) {
                // å…ˆæ’­æ”¾é€€åœºåŠ¨ç”»
                await this.triggerCourseBlockExitAnimation();
                
                const semesterStartDate = new Date(this.currentSemester.startDate);
                const targetDate = new Date(semesterStartDate);
                targetDate.setDate(semesterStartDate.getDate() + (weekNum - 1) * 7);

                this.currentDate = targetDate;
                this.updateCurrentSemesterFromDate(this.currentDate);
                this.calculateWeekDatesFromCurrentDate();
                
                // é‡æ–°è¯·æ±‚æ¥å£è·å–è¯¾ç¨‹æ•°æ®
                await this.loadCourseData();
              }
              this.showWeekPicker = false;
            })

            if (weekNum < this.totalWeeks) {
              Divider()
                .color('#F0F0F0')
                .strokeWidth(0.5)
            }
          })
        }
      }
      .layoutWeight(1) // ä½¿ç”¨layoutWeightè®©åˆ—è¡¨å æ®å‰©ä½™ç©ºé—´

      Row() {
        Button('å–æ¶ˆ')
          .width('80%')
          .height(45)
          .fontSize(16)
          .fontColor('#666666')
          .backgroundColor('#F5F5F5')
          .onClick(() => {
            this.showWeekPicker = false;
          })
      }
      .width('100%')
      .margin({ top: 20 })
      .justifyContent(FlexAlign.Center)
    }
    .width('100%')
    .padding(20)
    .backgroundColor(Color.White)
    .borderRadius({ topLeft: 20, topRight: 20 })
  }

  /**
   * è·å–è¯¾ç¨‹é¢œè‰²ç´¢å¼•ï¼ˆå‚è€ƒclass-schedule-cçš„é¢œè‰²è®¡ç®—é€»è¾‘ï¼‰
   */
  private getCourseColorIndex(courseName: string): number {
    let index = this.scheduleGrid.classList.indexOf(courseName);
    if (index === -1) {
      // å¦‚æœæ‰¾ä¸åˆ°ï¼Œä½¿ç”¨hashç®—æ³•è®¡ç®—
      let hash = 0;
      for (let i = 0; i < courseName.length; i++) {
        hash = courseName.charCodeAt(i) + ((hash << 5) - hash);
      }
      index = Math.abs(hash);
    }

    // å¦‚æœindexå¤§äº10ï¼Œå–ä½™æ“ä½œï¼ˆå‚è€ƒshow-list.vueé€»è¾‘ï¼‰
    if (index > 10) {
      index = index % 10;
    }

    return index;
  }

  /**
   * è·å–æŒ‡å®škeyçš„æ—¶é—´æ®µæ•°ç»„
   */
  private getSectionNumbers(key: string): number[] {
    switch (key) {
      case 'value1':
        return this.sections.value1;
      case 'value2':
        return this.sections.value2;
      case 'value3':
        return this.sections.value3;
      case 'value4':
        return this.sections.value4;
      case 'value5':
        return this.sections.value5;
      case 'value6':
        return this.sections.value6;
      default:
        return [];
    }
  }

  /**
   * æ£€æŸ¥æ˜¯å¦æ˜¯ä»Šå¤©
   */
  private isToday(dayIndex: number): boolean {
    const today = new Date();
    const currentWeekday = (today.getDay() + 6) % 7; // è½¬æ¢ä¸ºå‘¨ä¸€=0çš„æ ¼å¼
    return dayIndex === currentWeekday;
  }

  /**
   * è¯¾ç¨‹å—ç‚¹å‡»äº‹ä»¶ï¼ˆå‚è€ƒshow-list.vueçš„showItemæ–¹æ³•ï¼‰
   */
  private onCourseBlockClick(course: ScheduleCourse, dayIndex: number, courseIndex: number): void {
    console.info(`ğŸ“š [Course Click] ${course.courseName} - ${course.teacher.join(',')}`);

    // TODO: æ˜¾ç¤ºè¯¾ç¨‹è¯¦æƒ…å¼¹çª—ï¼ˆå‚è€ƒclass-schedule-cçš„è¯¾ç¨‹è¯¦æƒ…æ˜¾ç¤ºï¼‰
    // å¯ä»¥æ˜¾ç¤ºè¯¾ç¨‹åã€æ•™å¸ˆã€æ•™å®¤ã€æ—¶é—´ç­‰ä¿¡æ¯
  }

  /**
   * è·å–è¯¾ç¨‹èƒŒæ™¯é¢œè‰²ï¼ˆå‚è€ƒshow-list.vueçš„chooseColoræ–¹æ³•ï¼‰
   */
  private getCourseBackgroundColor(courseName: string): string {
    const colorIndex = this.getCourseColorIndex(courseName);
    const colors = [
      '#E3F2FD', '#F3E5F5', '#E8F5E8', '#FFF3E0',
      '#F1F8E9', '#FCE4EC', '#E0F2F1', '#FFF8E1',
      '#F9FBE7', '#E1F5FE', '#FAE8E4', '#F3E5AB',
      '#E8EAF6', '#FFEBEE', '#E0F7FA', '#FFF9C4',
      '#F1F8F0', '#FFEAA7', '#DDD6FE', '#FEF3C7'
    ];
    return colors[colorIndex % colors.length];
  }

  /**
   * è·å–è¯¾ç¨‹æ–‡å­—é¢œè‰²ï¼ˆå‚è€ƒshow-list.vueçš„chooseTxtColoræ–¹æ³•ï¼‰
   */
  private getCourseTextColor(courseName: string): string {
    const colorIndex = this.getCourseColorIndex(courseName);
    const colors = [
      '#1565C0', '#7B1FA2', '#2E7D32', '#EF6C00',
      '#558B2F', '#C2185B', '#00695C', '#F57F17',
      '#689F38', '#0277BD', '#D84315', '#F9A825',
      '#5E35B1', '#C62828', '#00838F', '#AFB42B',
      '#388E3C', '#FF8F00', '#512DA8', '#FBC02D'
    ];
    return colors[colorIndex % colors.length];
  }

  /**
   * è·å–è¯¾ç¨‹è¾¹æ¡†é¢œè‰²ï¼ˆå‚è€ƒshow-list.vueçš„borderColoræ–¹æ³•ï¼‰
   */
  private getCourseBorderColor(courseName: string): string {
    const colorIndex = this.getCourseColorIndex(courseName);
    const colors = [
      '#42A5F5', '#BA68C8', '#66BB6A', '#FF9800',
      '#8BC34A', '#E91E63', '#26A69A', '#FFEB3B',
      '#9CCC65', '#29B6F6', '#FF5722', '#FDD835',
      '#9575CD', '#F44336', '#00BCD4', '#CDDC39',
      '#4CAF50', '#FFC107', '#673AB7', '#FFEB3B'
    ];
    return colors[colorIndex % colors.length];
  }

  /**
   * è§¦å‘è¯¾ç¨‹å—å…¥åœºåŠ¨ç”»ï¼ˆä¸€æ¬¡æ€§å…¨éƒ¨æ˜¾ç¤ºï¼‰
   */
  private triggerCourseBlockEnterAnimation(): void {
    console.info('ğŸ“… [Animation] å¼€å§‹è§¦å‘è¯¾ç¨‹å—å…¥åœºåŠ¨ç”»ï¼ˆä¸€æ¬¡æ€§æ˜¾ç¤ºï¼‰');
    
    // ç®€å•å»¶è¿Ÿåä¸€æ¬¡æ€§æ˜¾ç¤ºæ‰€æœ‰è¯¾ç¨‹
    setTimeout(() => {
      // æ¸…ç©ºæ§åˆ¶çŠ¶æ€ï¼Œè®©æ‰€æœ‰è¯¾ç¨‹æ˜¾ç¤º
      this.courseBlockVisible = [];
      console.info('ğŸ“… [Animation] æ‰€æœ‰è¯¾ç¨‹å·²æ˜¾ç¤º');
    }, 50); // ä»100å‡å°‘åˆ°50ï¼Œè¿›ä¸€æ­¥åŠ å¿«æ˜¾ç¤ºé€Ÿåº¦
  }

  /**
   * è§¦å‘è¯¾ç¨‹å—é€€åœºåŠ¨ç”»
   */
  private triggerCourseBlockExitAnimation(): Promise<void> {
    return new Promise((resolve) => {
      console.info('ğŸ“… [Animation] å¼€å§‹é€€åœºåŠ¨ç”»');
      
      // åˆå§‹åŒ–éšè—çŠ¶æ€
      for (let dayIndex = 0; dayIndex < 7; dayIndex++) {
        this.courseBlockVisible[dayIndex] = [];
        const courseCount = this.scheduleGrid.nowClassList[dayIndex]?.length || 0;
        
        for (let courseIndex = 0; courseIndex < courseCount; courseIndex++) {
          this.courseBlockVisible[dayIndex][courseIndex] = false;
        }
      }
      
      // ç­‰å¾…è½¬åœºåŠ¨ç”»å®Œæˆ
      setTimeout(() => {
        console.info('ğŸ“… [Animation] é€€åœºåŠ¨ç”»å®Œæˆ');
        resolve();
      }, 100); // ä»200å‡å°‘åˆ°100ï¼Œè¿›ä¸€æ­¥åŠ å¿«æ¶ˆå¤±é€Ÿåº¦
    });
  }

}