import router from '@ohos.router';
import { ConfigApiService } from '../services/api/ConfigApiService';

@Entry
@Component
struct Index {
  @State message: string = 'æ¬¢è¿ä½¿ç”¨éœå®¢è¯¾è¡¨';
  private configService: ConfigApiService = ConfigApiService.getInstance();

  aboutToAppear(): void {
    // åœ¨åº”ç”¨å¯åŠ¨æ—¶é¢„åŠ è½½é…ç½®ä¿¡æ¯
    this.preloadConfiguration();
  }
  
  /**
   * é¢„åŠ è½½é…ç½®ä¿¡æ¯
   */
  private async preloadConfiguration(): Promise<void> {
    try {
      console.info('ğŸš€ [App Init] å¼€å§‹é¢„åŠ è½½é…ç½®ä¿¡æ¯');
      // å¼‚æ­¥åŠ è½½é…ç½®ï¼Œä¸é˜»å¡UIå±•ç¤º
      await this.configService.getConfig();
      console.info('âœ… [App Init] é…ç½®ä¿¡æ¯é¢„åŠ è½½å®Œæˆ');
    } catch (error) {
      console.warn('âš ï¸ [App Init] é…ç½®é¢„åŠ è½½å¤±è´¥ï¼Œå°†åœ¨è¯¾è¡¨é¡µé¢é‡è¯•:', error);
    } finally {
      // 2ç§’åè·³è½¬ï¼Œç¡®ä¿ç”¨æˆ·çœ‹åˆ°å¯åŠ¨ç”»é¢
      setTimeout(() => {
        router.replaceUrl({
          url: 'pages/first/ClassSelectPage'
        });
      }, 2000);
    }
  }

  build() {
    RelativeContainer() {
      Column() {
        Image($r('app.media.startIcon'))
          .width(80)
          .height(80)
          .margin({ bottom: 20 })

        Text(this.message)
          .fontSize(24)
          .fontWeight(FontWeight.Bold)
          .fontColor('#179FA2')
          .textAlign(TextAlign.Center)

        Text('æ­£åœ¨åˆå§‹åŒ–...')
          .fontSize(14)
          .fontColor('#999999')
          .margin({ top: 20 })
          .textAlign(TextAlign.Center)

        LoadingProgress()
          .width(30)
          .height(30)
          .color('#45CAD9')
          .margin({ top: 20 })
      }
      .alignRules({
        center: { anchor: '__container__', align: VerticalAlign.Center },
        middle: { anchor: '__container__', align: HorizontalAlign.Center }
      })
    }
    .height('100%')
    .width('100%')
    .backgroundColor('#F8F8F8')
  }
}