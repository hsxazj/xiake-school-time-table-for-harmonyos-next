# HarmonyOS ArkTS 动画体系完全速查表  

## 1. 属性动画（Attribute Animation）

### 1.1 系统可动画属性总览

| 类别      | 具体属性                                                  |
| --------- | --------------------------------------------------------- |
| 布局      | width、height、padding、margin、position、align、weight … |
| 仿射变换  | translate、scale、rotate、transformCenter …               |
| 外观      | opacity、borderRadius、borderWidth、shadow …              |
| 背景&前景 | backgroundColor、backgroundBlur、foregroundColor …        |
| 内容      | fontSize、fontColor、textAlign、imageBlur …               |

> 不可动画：focusable、enabled、zIndex 等不会引起 UI 变化的属性。

---

### 1.2 三种驱动接口对比

| 接口                | 作用域         | 触发方式             | 适用场景         | 备注         |
| ------------------- | -------------- | -------------------- | ---------------- | ------------ |
| `animateTo`         | 闭包内所有差异 | 手动包闭包           | 多属性统一参数   | 支持嵌套     |
| `animation`         | 紧跟其后的属性 | 属性值变化即自动播放 | 单属性不同参数   | 自下而上执行 |
| `keyframeAnimateTo` | 多段闭包       | 数组关键帧           | 同一属性连续变化 | 衔接平滑     |

---

### 1.3 代码示例

#### ① animateTo 通用写法
```ts
@Entry
@Component
struct AnimateToDemo {
  @State isBig: boolean = false;

  build() {
    Column({ space: 20 }) {
      Column()
        .width(this.isBig ? 200 : 100)
        .height(100)
        .backgroundColor(Color.Blue)
      Button('animateTo')
        .onClick(() => {
          animateTo({ duration: 500, curve: Curve.Ease }, () => {
            this.isBig = !this.isBig;
          });
        })
    }.padding(30)
  }
}
```

#### ② animation 绑定单个属性
```ts
Text('Hello ArkTS')
  .fontSize(this.fontSize)
  .animation({ duration: 600, curve: Curve.Spring }) // 仅对 fontSize 生效
```

#### ③ keyframeAnimateTo 关键帧
```ts
@State offsetX: number = 0;

Button('Keyframe')
  .onClick(() => {
    keyframeAnimateTo(
      { duration: 1500 },
      [
        { closure: () => (this.offsetX = 100), duration: 500, curve: Curve.EaseIn },
        { closure: () => (this.offsetX = 0),   duration: 500, curve: Curve.EaseOut }
      ]
    );
  })
```

---

### 1.4 自定义可动画属性

#### ① 基于 number
```ts
@AnimatableExtend(Text)
function animatableWidth(width: number) {
  .width(width);
}

@Entry
@Component
struct CustomNumberDemo {
  @State w: number = 80;

  build() {
    Column({ space: 20 }) {
      Text('Custom')
        .animatableWidth(this.w)
        .animation({ duration: 1200, curve: Curve.Ease })
      Button('Toggle').onClick(() => this.w = this.w === 80 ? 200 : 80)
    }
  }
}
```

#### ② 基于自定义数据结构（实现 AnimatableArithmetic）
```ts
class Point {
  constructor(public x: number, public y: number) {}
  add(rhs: Point)    { return new Point(this.x + rhs.x, this.y + rhs.y); }
  subtract(rhs: Point) { return new Point(this.x - rhs.x, this.y - rhs.y); }
  multiply(scale: number) { return new Point(this.x * scale, this.y * scale); }
  equals(rhs: Point) { return this.x === rhs.x && this.y === rhs.y; }
}

@AnimatableExtend(Polyline)
function animatablePoints(points: Point[]) {
  .points(points.map(p => [p.x, p.y]));
}

@Entry
@Component
struct CustomPointDemo {
  @State pts: Point[] = [
    new Point(10, 10), new Point(100, 10),
    new Point(100, 100), new Point(10, 100)
  ];

  build() {
    Column() {
      Polyline()
        .width('100%').height(300)
        .fill('#317AF7')
        .animatablePoints(this.pts)
        .animation({ duration: 1000 })
      Button('Morph').onClick(() => {
        this.pts = this.pts.map(p => new Point(p.x + 50, p.y + 50));
      })
    }
  }
}
```

---

## 2. 转场动画（Transition Animation）

> 仅对「即将出现/消失」的节点生效；常驻节点请用属性动画。

---

### 2.1 出现/消失转场（transition）

#### 常用 TransitionEffect
```ts
import { TransitionEffect } from '@kit.ArkUI';

const slideInOut = TransitionEffect.SLIDE
  .combine(TransitionEffect.OPACITY)
  .animation({ duration: 400 });
```

#### 完整示例
```ts
@Entry
@Component
struct EnterExitDemo {
  @State show: boolean = false;

  build() {
    Column({ space: 20 }) {
      if (this.show) {
        Column()
          .width(100).height(100)
          .backgroundColor(Color.Green)
          .transition(slideInOut)
      }
      Button('Toggle')
        .onClick(() => this.show = !this.show)
    }.padding(30)
  }
}
```

---

### 2.2 模态转场（Modal）

| 接口               | 描述     | 典型场景   |
| ------------------ | -------- | ---------- |
| `bindContentCover` | 全屏模态 | 大图查看器 |
| `bindSheet`        | 半模态   | 分享面板   |
| `bindPopup`        | 小弹窗   | 气泡提示   |

#### bindContentCover 示例
```ts
@Builder
function FullScreenModal() {
  Column()
    .width('100%').height('100%')
    .backgroundColor('#000')
    .onClick(() => router.back());
}

@Entry
@Component
struct ModalDemo {
  @State isShow: boolean = false;

  build() {
    Column() {
      Image($r('app.media.thumb'))
        .width(120).height(120)
        .onClick(() => this.isShow = true)
        .bindContentCover(
          $$this.isShow,
          FullScreenModal(),
          { modalTransition: ModalTransition.ALPHA }
        )
    }
  }
}
```

---

### 2.3 共享元素转场（一镜到底）

#### 方案 1：geometryTransition（最简单，系统托管）
```ts
// PageA
Image($r('app.media.avatar'))
  .width(80).height(80)
  .geometryTransition('avatarId')   // 唯一 id
  .onClick(() => router.pushUrl('pages/PageB'))

// PageB
Image($r('app.media.avatar'))
  .width(200).height(200)
  .geometryTransition('avatarId')   // 同一 id
```

#### 方案 2：NodeController 迁移（复杂场景）
> 思路：  
> 1. 点击时记录源节点位置、大小；  
> 2. 新建全屏节点并迁移组件；  
> 3. 执行属性动画；  
> 4. 动画结束迁移回原节点。

完整代码较长，可查阅官方 Demo：  
`/samples/ArkUI/SharedElementTransition`

---

### 2.4 旋转屏动画

#### ① 布局切换（系统默认）
在 `module.json5` 中：
```json5
"orientation": "auto_rotation"
```

#### ② 透明度切换（手动监听）
```ts
windowStage.on('windowSizeChange', () => {
  animateTo({ duration: 300 }, () => {
    this.showLandscape = !this.showLandscape;
  });
});
```

---

## 3. 页面转场（PageTransition）

> 官方推荐改用 Navigation 路由转场，pageTransition 仅作兼容。

```ts
pageTransition() {
  PageTransitionEnter({ type: RouteType.Push, duration: 300 })
    .slide(SlideEffect.Right);
  PageTransitionExit({ type: RouteType.Pop, duration: 300 })
    .slide(SlideEffect.Left);
}
```

---

## 4. 动画曲线（Curve）

| 类别     | 常用枚举                                                     | 特点                 |
| -------- | ------------------------------------------------------------ | -------------------- |
| 传统曲线 | `Curve.Linear` / `Ease` / `EaseIn` / `EaseOut` / `EaseInOut` | 简单、匀速或缓入缓出 |
| 物理弹簧 | `Curve.Spring` / `ResponsiveSpring`                          | 符合真实物理、更自然 |

示例：
```ts
.animation({ duration: 500, curve: Curve.Spring })
```

---

## 5. 性能与最佳实践

- 频繁变化优先使用 `scale` 而非 `width/height`，避免布局测量。  
- 不需要监听动画结束就不要写 `onFinish`，减少状态同步开销。  
- 共享元素确保两端节点尺寸一致，避免跳变。  
- 对列表大量 item 做出现/消失转场时，给不同 item 设置 `delay` 实现瀑布流效果。

---

> 至此，官方文档中所有核心动画能力、API 与完整代码示例均已汇总。祝编码愉快！