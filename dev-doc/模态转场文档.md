# 鸿蒙ArkTS模态转场开发指南

## 概述

模态转场是鸿蒙系统中实现界面转换的重要方式，它允许新界面覆盖在旧界面上，而旧界面不消失。ArkTS提供了多种模态转场方式，包括全屏模态转场、半模态转场、菜单弹出等，能够提升应用的交互体验。

## 全屏模态转场

### 基本概念

通过`bindContentCover`属性为组件绑定全屏模态页面，在组件插入和删除时可通过设置转场参数`ModalTransition`显示过渡动效。

### API说明

```typescript
bindContentCover(isShow: boolean, builder: CustomBuilder, options?: ContentCoverOptions)
```

**参数说明：**

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| isShow | boolean | 是 | 是否显示全屏模态页面。从API version 10开始支持$$双向绑定变量 |
| builder | CustomBuilder | 是 | 配置全屏模态页面内容 |
| options | ContentCoverOptions | 否 | 配置全屏模态页面的可选属性 |

**ContentCoverOptions结构：**

| 名称 | 类型 | 必填 | 描述 |
|------|------|------|------|
| modalTransition | ModalTransition | 否 | 全屏模态页面的转场方式 |
| backgroundColor | ResourceColor | 否 | 全屏模态页面的背板颜色 |
| onAppear | () => void | 否 | 全屏模态页面显示回调函数 |
| onDisappear | () => void | 否 | 全屏模态页面回退回调函数 |

### ModalTransition枚举类型

| 名称 | 描述 |
|------|------|
| NONE | 全屏模态无转场动画 |
| DEFAULT | 全屏模态上下切换动画 |
| ALPHA | 全屏模态透明度渐变动画 |

### 代码示例

```typescript
// 全屏模态转场示例
import curves from '@ohos.curves';

@Entry
@Component
struct BindContentCoverDemo {
  @State isPresent: boolean = false;

  @Builder MyBuilder() {
    Column() {
      Column() {
        Column() {
          Text('back')
            .fontSize(24)
            .fontColor(Color.White)
        }
        .justifyContent(FlexAlign.Center)
        .width(100)
        .height(100)
        .borderRadius(5)
        .backgroundColor(0xf56c6c)
        .onClick(() => {
          this.isPresent = false;
        })
      }
      .height('100%')
      .width('100%')
      .backgroundColor(0x909399)
      .justifyContent(FlexAlign.Center)
    }
    .height('100%')
    .justifyContent(FlexAlign.End)
    .transition(TransitionEffect.translate({ y: 1000 }).animation({ curve: curves.springMotion(0.6, 0.8) }))
  }

  build() {
    Column() {
      Column() {
        Text('Click Me')
          .fontSize(24)
          .fontColor(Color.White)
      }
      .onClick(() => {
        this.isPresent = !this.isPresent;
      })
      .bindContentCover(this.isPresent, this.MyBuilder(), ModalTransition.DEFAULT)
      .justifyContent(FlexAlign.Center)
      .backgroundColor(0XF56C6C)
      .width(100)
      .height(100)
      .borderRadius(5)
    }
    .justifyContent(FlexAlign.Center)
    .width('100%')
    .height('100%')
  }
}
```

## 半模态转场

### 基本概念

通过`bindSheet`属性为组件绑定半模态页面，在组件插入时可通过设置自定义或默认的内置高度确定半模态大小。

### API说明

```typescript
bindSheet(isShow: boolean, builder: CustomBuilder, options?: SheetOptions)
```

**参数说明：**

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| isShow | boolean | 是 | 是否显示半模态页面。从API version 10开始支持$$双向绑定变量 |
| builder | CustomBuilder | 是 | 配置半模态页面内容 |
| options | SheetOptions | 否 | 配置半模态页面的可选属性 |

**SheetOptions结构：**

| 名称 | 类型 | 必填 | 描述 |
|------|------|------|------|
| height | SheetSize \| Length | 否 | 半模态高度 |
| dragBar | boolean | 否 | 是否显示控制条，默认显示 |
| maskColor | ResourceColor | 否 | 半模态页面的背景蒙层颜色 |

### SheetSize枚举类型

| 名称 | 参数描述 |
|------|----------|
| MEDIUM | 指定半模态高度为屏幕高度一半 |
| LARGE | 指定半模态高度几乎为屏幕高度 |

### 代码示例

```typescript
// 半模态转场示例
@Entry
@Component
struct SheetTransitionExample {
  @State isShow: boolean = false
  @State sheetHeight: number = 300;
  @State showDragBar: boolean = true;

  @Builder myBuilder() {
    Column() {
      Button("change height")
        .margin(10)
        .fontSize(20)
        .onClick(() => {
          this.sheetHeight = 500;
        })

      Button("close dragBar")
        .margin(10)
        .fontSize(20)
        .onClick(() => {
          this.showDragBar = false;
        })

      Button("close modal 1")
        .margin(10)
        .fontSize(20)
        .onClick(() => {
          this.isShow = false;
        })
    }
    .width('100%')
    .height('100%')
  }

  build() {
    Column() {
      Button("transition modal 1")
        .onClick(() => {
          this.isShow = true
        })
        .fontSize(20)
        .margin(10)
        .bindSheet($$this.isShow, this.myBuilder(), {
          height: this.sheetHeight, 
          dragBar: this.showDragBar, 
          maskColor: Color.Green, 
          onAppear: () => {
            console.log("BindSheet onAppear.")
          }, 
          onDisappear: () => {
            console.log("BindSheet onDisappear.")
          }
        })
    }
    .justifyContent(FlexAlign.Center)
    .width('100%')
    .height('100%')
  }
}
```

## 其他模态转场方式

除了全屏和半模态转场外，ArkTS还提供了其他模态转场方式：

| 接口 | 说明 | 使用场景 |
|------|------|----------|
| bindMenu | 弹出菜单，点击组件后弹出 | 需要Menu菜单的场景，如一般应用的"+"号键 |
| bindContextMenu | 弹出菜单，长按或者右键点击后弹出 | 长按浮起效果，一般结合拖拽框架使用，如桌面图标长按浮起 |
| bindPopup | 弹出Popup弹框 | Popup弹框场景，如点击后对某个组件进行临时说明 |
| if | 通过if新增或删除组件 | 用来在某个状态下临时显示一个界面，这种方式的返回导航需要由开发者监听接口实现 |

## 开发注意事项

1.  **API版本支持**：模态转场功能从API Version 10开始支持。
2.  **横竖屏切换**：不支持横竖屏切换。
3.  **路由跳转**：不支持路由跳转。
4.  **双向绑定**：建议使用`$$`双向绑定isShow参数，以使isShow参数值与半模态界面的状态同步。

## 总结

模态转场是鸿蒙ArkTS中强大的界面交互方式，提供了全屏模态转场、半模态转场等多种形式，可以满足不同场景下的界面交互需求。通过合理使用这些转场方式，可以显著提升应用的用户体验和交互流畅度。

在实际开发中，开发者可以根据具体需求选择合适的模态转场方式，并通过调整转场动画、背景颜色、高度等参数来实现自定义的转场效果。